<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Museum Directory</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 2em auto;
            max-width: 1000px;
            background: #F8F8F8;
            color: #333;
            line-height: 1.6;
            font-size: 1.05em;
        }

        h1 {
            text-align: center;
            color: #2C3E50;
            font-family: 'Merriweather', serif;
            font-weight: 700;
            margin-bottom: 1.5em;
            font-size: 2.5em;
            letter-spacing: -0.02em;
        }

        .filters-container {
            padding: 2em;
            background-color: #FFFFFF;
            border-radius: 6px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            margin-bottom: 3em;
            border-top: 4px solid #0056B3;
        }

        .filter-group {
            margin-bottom: 1.5em;
        }

        .filter-group label {
            display: block;
            margin-bottom: 0.6em;
            font-weight: 700;
            color: #444;
            font-size: 1.05em;
        }

        .filters-container input[type="text"],
        .filters-container select {
            width: 100%;
            padding: 0.9em 12px;
            border: 1px solid #C0C0C0;
            border-radius: 4px;
            font-size: 1em;
            box-sizing: border-box;
            color: #333;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .filters-container input[type="text"]:focus,
        .filters-container select:focus {
            border-color: #007BFF;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.2);
            outline: none;
        }

        .match-type-options {
            display: flex;
            gap: 1.5em;
            align-items: center;
            margin-top: 0.7em;
        }

        .match-type-options label {
            font-weight: 400;
            margin-bottom: 0;
            display: inline-flex;
            align-items: center;
            gap: 0.4em;
            color: #555;
            font-size: 0.95em;
        }

        .match-type-options input[type="radio"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid #999;
            border-radius: 50%;
            outline: none;
            cursor: pointer;
            position: relative;
            transition: border-color 0.2s ease;
        }

        .match-type-options input[type="radio"]:checked {
            border-color: #0056B3;
        }

        .match-type-options input[type="radio"]:checked::before {
            content: '';
            display: block;
            width: 10px;
            height: 10px;
            background: #0056B3;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.8em;
        }

        .museum {
            background: #FFFFFF;
            margin: 1.5em 0;
            padding: 2em;
            border: 1px solid #E0E0E0;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            transition: box-shadow 0.3s ease, transform 0.2s ease;
        }

        .museum:hover {
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            transform: translateY(-3px);
        }

        .museum h2 {
            margin-top: 0;
            margin-bottom: 0.7em;
            color: #0056B3;
            font-family: 'Merriweather', serif;
            font-weight: 700;
            font-size: 1.8em;
        }

        .museum p {
            margin: 0.6em 0;
            color: #444;
        }

        .museum strong {
            color: #2C3E50;
            font-weight: 700;
        }

        .museum a {
            color: #007BFF;
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .museum a:hover {
            text-decoration: underline;
            color: #0056B3;
        }

        #results p.no-results,
        #loadingMessage {
            text-align: center;
            font-size: 1.25em;
            color: #7F8C8D;
            padding: 2em;
            font-weight: 400;
        }

        #loadingMessage {
            color: #0056B3;
            font-weight: 700;
        }

        @media (max-width: 768px) {
            body {
                margin: 1.5em;
                font-size: 1em;
            }
            h1 {
                font-size: 2em;
            }
            .filters-container {
                padding: 1.5em;
            }
            .filter-grid {
                grid-template-columns: 1fr;
            }
            .museum {
                padding: 1.5em;
            }
            .museum h2 {
                font-size: 1.5em;
            }
            #results p.no-results,
            #loadingMessage {
                font-size: 1.1em;
                padding: 1.5em;
            }
        }
    </style>
</head>
<body>

    <h1>Museum Directory</h1>

    <div class="filters-container">
        <div class="filter-grid">
            <div class="filter-group">
                <label for="searchName">Search by Name:</label>
                <input type="text" id="searchName" placeholder="e.g., National Museum">
            </div>

            <div class="filter-group">
                <label for="searchState">Filter by State/UT:</label>
                <select id="searchState">
                    <option value="">All States/UTs</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="searchTheme">Filter by Theme:</label>
                <select id="searchTheme">
                    <option value="">All Themes</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="searchOwnership">Search by Ownership:</label>
                <input type="text" id="searchOwnership" placeholder="e.g., Government, Private">
            </div>

            <div class="filter-group">
                <label for="searchOverview">Search in Overview (comma-separated):</label>
                <input type="text" id="searchOverview" placeholder="e.g., artifacts, independence" style="flex-grow: 1;">
                <div class="match-type-options" style="margin-top: 0.5em;">
                    <label><input type="radio" name="overviewMatch" value="any" checked> Match Any Word</label>
                    <label><input type="radio" name="overviewMatch" value="all"> Match All Words</label>
                </div>
            </div>
        </div>
    </div>

    <div id="loadingMessage">Loading museum data...</div>
    <div id="resultCount" style="text-align: center; font-size: 1.1em; color: #666; margin-bottom: 1.5em; font-weight: 500;"></div>
    <div id="results"></div>

    <script>
        let allMuseumsArray = [];

        function debounce(func, delay) {
            let timeoutId;
            return function(...args) {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => {
                    func.apply(this, args);
                }, delay);
            };
        }

        async function loadData() {
            const loadingMessage = document.getElementById('loadingMessage');
            try {
                const response = await fetch('output/output.json');

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const museumsData = await response.json();
                allMuseumsArray = Object.values(museumsData);

                populateStateDropdown();
                populateThemeDropdown();
                renderResults(allMuseumsArray);
                loadingMessage.style.display = 'none';
            } catch (error) {
                console.error("Failed to load museum data:", error);
                loadingMessage.textContent = 'Failed to load museum data. Please try again later.';
                document.getElementById('results').innerHTML = '<p class="no-results">Could not load museum information.</p>';
            }
        }

        function populateStateDropdown() {
            const stateDropdown = document.getElementById('searchState');
            const states = new Set();
            allMuseumsArray.forEach(m => {
                if (m["state/ut"] && m["state/ut"].trim()) {
                    states.add(m["state/ut"].trim());
                }
            });
            const sortedStates = Array.from(states).sort();
            sortedStates.forEach(state => {
                const option = document.createElement('option');
                option.value = state.toLowerCase();
                option.textContent = state;
                stateDropdown.appendChild(option);
            });
        }

        function populateThemeDropdown() {
            const themeDropdown = document.getElementById('searchTheme');
            const themes = new Set();
            allMuseumsArray.forEach(m => {
                if (m.theme && m.theme.trim()) {
                    m.theme.split(',').forEach(theme => {
                        const trimmedTheme = theme.trim();
                        if (trimmedTheme) {
                            themes.add(trimmedTheme);
                        }
                    });
                }
            });
            const sortedThemes = Array.from(themes).sort();
            sortedThemes.forEach(theme => {
                const option = document.createElement('option');
                option.value = theme.toLowerCase();
                option.textContent = theme;
                themeDropdown.appendChild(option);
            });
        }

        function renderResults(data) {
            const container = document.getElementById('results');
            const countContainer = document.getElementById('resultCount');
            container.innerHTML = '';

            const count = data.length;
            if (count === 0) {
                countContainer.textContent = 'No museums found matching your criteria.';
                container.innerHTML = '<p class="no-results">No museums found matching your criteria.</p>';
                return;
            }

            countContainer.textContent = `Showing ${count} museum${count === 1 ? '' : 's'}`;

            const fragment = document.createDocumentFragment();
            data.forEach(m => {
                const div = document.createElement('div');
                div.className = 'museum';
                div.innerHTML = `
                    <h2>${m.name || 'N/A'}</h2>
                    <p><strong>Address:</strong> ${m.address || 'N/A'}</p>
                    <p><strong>State/UT:</strong> ${m["state/ut"] || 'N/A'}</p>
                    <p><strong>Year of Establishment:</strong> ${m["year of establishment"] || 'N/A'}</p>
                    <p><strong>Theme:</strong> ${m.theme || 'N/A'}</p>
                    <p><strong>Ownership:</strong> ${m.ownership || 'N/A'}</p>
                    <p><strong>Overview:</strong> ${m.overview || 'N/A'}</p>
                    <p><strong>Contact:</strong> ${m.contact || 'N/A'}</p>
                    <p><strong>Admission:</strong> ${m.admission || 'N/A'}</p>
                    <p><strong>Timings:</strong> ${m.timings || 'N/A'}</p>
                    <p><strong>Website:</strong> ${m.website ? `<a href="${m.website.startsWith('http') ? m.website : 'http://' + m.website}" target="_blank" rel="noopener noreferrer">${m.website}</a>` : 'N/A'}</p>
                `;
                fragment.appendChild(div);
            });
            container.appendChild(fragment);
        }

        function filterResults() {
            const nameFilter = document.getElementById('searchName').value.toLowerCase();
            const stateFilter = document.getElementById('searchState').value.toLowerCase();
            const themeFilter = document.getElementById('searchTheme').value.toLowerCase();
            const ownershipFilter = document.getElementById('searchOwnership').value.toLowerCase();

            const overviewSearchString = document.getElementById('searchOverview').value.toLowerCase();
            const overviewKeywords = overviewSearchString.split(',')
                                                    .map(k => k.trim())
                                                    .filter(k => k.length > 0);
            const overviewMatchType = document.querySelector('input[name="overviewMatch"]:checked').value;

            const filtered = allMuseumsArray.filter(m => {
                const nameMatch = !nameFilter || (m.name && m.name.toLowerCase().includes(nameFilter));
                const stateMatch = !stateFilter || (m["state/ut"] && m["state/ut"].toLowerCase().includes(stateFilter));
                const ownershipMatch = !ownershipFilter || (m.ownership && m.ownership.toLowerCase().includes(ownershipFilter));
                const themeMatch = !themeFilter || (m.theme && m.theme.toLowerCase().includes(themeFilter));

                let overviewMatchResult = true;
                if (overviewKeywords.length > 0) {
                    if (!m.overview) {
                        overviewMatchResult = false;
                    } else {
                        const museumOverviewLower = m.overview.toLowerCase();
                        if (overviewMatchType === 'any') {
                            overviewMatchResult = overviewKeywords.some(keyword => museumOverviewLower.includes(keyword));
                        } else {
                            overviewMatchResult = overviewKeywords.every(keyword => museumOverviewLower.includes(keyword));
                        }
                    }
                }
                return nameMatch && stateMatch && themeMatch && ownershipMatch && overviewMatchResult;
            });
            renderResults(filtered);
        }

        const debouncedFilterResults = debounce(filterResults, 350);

        document.getElementById('searchName').addEventListener('input', debouncedFilterResults);
        document.getElementById('searchState').addEventListener('change', filterResults);
        document.getElementById('searchTheme').addEventListener('change', filterResults);
        document.getElementById('searchOwnership').addEventListener('input', debouncedFilterResults);
        document.getElementById('searchOverview').addEventListener('input', debouncedFilterResults);
        document.querySelectorAll('input[name="overviewMatch"]').forEach(radio => {
            radio.addEventListener('change', filterResults);
        });

        loadData();
    </script>
</body>
</html>